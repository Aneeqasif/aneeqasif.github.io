#+TITLE: Code blocks
#+published: 2026-09-09
#+description: Testing stuff related to clode blocks
#+draft: false
#+tags: [demo, testing]
#+category: Demo
#+series: { name: "testing blog", part: 3 }


* Example Blocks :folded:

#+begin_example
shape: (3, 7)
┌──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬───────┬──────┬──────┬──────┐
│ col1 ┆ col2 ┆ col3 ┆ col3 ┆ col3 ┆ col3 ┆ col3 ┆ col3 ┆ col3 ┆ col3 ┆ col3 ┆ col3 ┆ col3 ┆ col3 ┆ col3 ┆ col3 ┆ col4  ┆ col5 ┆ col6 ┆ col7 │
│ ---  ┆ ---  ┆ ---  ┆ ---  ┆ ---  ┆ ---  ┆ ---  ┆ ---  ┆ ---  ┆ ---  ┆ ---  ┆ ---  ┆ ---  ┆ ---  ┆ ---  ┆ ---  ┆ ---   ┆ ---  ┆ ---  ┆ ---  │
│ i64  ┆ str  ┆ f64  ┆ f64  ┆ f64  ┆ f64  ┆ f64  ┆ f64  ┆ f64  ┆ f64  ┆ f64  ┆ f64  ┆ f64  ┆ f64  ┆ f64  ┆ f64  ┆ bool  ┆ i64  ┆ str  ┆ f64  │
╞══════╪══════╪══════╪══════╪══════╪══════╪══════╪══════╪══════╪══════╪══════╪══════╪══════╪══════╪══════╪══════╪═══════╪══════╪══════╪══════╡
│ 1    ┆ a    ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ true  ┆ 100  ┆ x    ┆ 0.1  │
│ 1    ┆ a    ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ true  ┆ 100  ┆ x    ┆ 0.1  │
│ 1    ┆ a    ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ true  ┆ 100  ┆ x    ┆ 0.1  │
│ 1    ┆ a    ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ true  ┆ 100  ┆ x    ┆ 0.1  │
│ 1    ┆ a    ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ true  ┆ 100  ┆ x    ┆ 0.1  │
│ 1    ┆ a    ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ true  ┆ 100  ┆ x    ┆ 0.1  │
│ 1    ┆ a    ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ true  ┆ 100  ┆ x    ┆ 0.1  │
│ 2    ┆ b    ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ false ┆ 200  ┆ y    ┆ 0.2  │
│ 1    ┆ a    ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ true  ┆ 100  ┆ x    ┆ 0.1  │
│ 1    ┆ a    ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ true  ┆ 100  ┆ x    ┆ 0.1  │
│ 1    ┆ a    ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ true  ┆ 100  ┆ x    ┆ 0.1  │
│ 2    ┆ b    ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ false ┆ 200  ┆ y    ┆ 0.2  │
│ 2    ┆ b    ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ false ┆ 200  ┆ y    ┆ 0.2  │
│ 2    ┆ b    ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ false ┆ 200  ┆ y    ┆ 0.2  │
│ 2    ┆ b    ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ false ┆ 200  ┆ y    ┆ 0.2  │
│ 2    ┆ b    ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ false ┆ 200  ┆ y    ┆ 0.2  │
│ 2    ┆ b    ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ false ┆ 200  ┆ y    ┆ 0.2  │
│ 2    ┆ b    ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ false ┆ 200  ┆ y    ┆ 0.2  │
│ 1    ┆ a    ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ true  ┆ 100  ┆ x    ┆ 0.1  │
│ 1    ┆ a    ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ true  ┆ 100  ┆ x    ┆ 0.1  │
│ 1    ┆ a    ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ true  ┆ 100  ┆ x    ┆ 0.1  │
│ 1    ┆ a    ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ 10.5 ┆ true  ┆ 100  ┆ x    ┆ 0.1  │
│ 2    ┆ b    ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ false ┆ 200  ┆ y    ┆ 0.2  │
│ 2    ┆ b    ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ false ┆ 200  ┆ y    ┆ 0.2  │
│ 2    ┆ b    ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ false ┆ 200  ┆ y    ┆ 0.2  │
│ 2    ┆ b    ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ false ┆ 200  ┆ y    ┆ 0.2  │
│ 2    ┆ b    ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ false ┆ 200  ┆ y    ┆ 0.2  │
│ 2    ┆ b    ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ 20.1 ┆ false ┆ 200  ┆ y    ┆ 0.2  │
│ 3    ┆ c    ┆ 30.2 ┆ 30.2 ┆ 30.2 ┆ 30.2 ┆ 30.2 ┆ 30.2 ┆ 30.2 ┆ 30.2 ┆ 30.2 ┆ 30.2 ┆ 30.2 ┆ 30.2 ┆ 30.2 ┆ 30.2 ┆ true  ┆ 300  ┆ z    ┆ 0.3  │
└──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴───────┴──────┴──────┴──────┘
#+end_example



smaller scrollbar


#+begin_example
┌──────┬──────┬──────┬───────┬──────┬──────┬──────┐
│ col1 ┆ col2 ┆ col3 ┆ col4  ┆ col5 ┆ col6 ┆ col7 │
│ ---  ┆ ---  ┆ ---  ┆ ---   ┆ ---  ┆ ---  ┆ ---  │
│ i64  ┆ str  ┆ f64  ┆ bool  ┆ i64  ┆ str  ┆ f64  │
╞══════╪══════╪══════╪═══════╪══════╪══════╪══════╡
│ 1    ┆ a    ┆ 10.5 ┆ true  ┆ 100  ┆ x    ┆ 0.1  │
│ 2    ┆ b    ┆ 20.1 ┆ false ┆ 200  ┆ y    ┆ 0.2  │
│ 3    ┆ c    ┆ 30.2 ┆ true  ┆ 300  ┆ z    ┆ 0.3  │
└──────┴──────┴──────┴───────┴──────┴──────┴──────┘
#+end_example

Empty blocks are not going to be exported

#+begin_example


#+end_example



* Sql Blocks

#+begin_src jupyter-python :eval never :esql
print("hello world")
%%sql --save not_nulls --no-execute
%%sql --save not_nulls --no-execute

SELECT *
FROM penguins.csv
WHERE bill_length_mm IS NOT NULL
AND bill_depth_mm IS NOT NULL

%sqlplot boxplot --column bill_length_mm bill_depth_mm --table not_nulls

#+end_src


* Code Blocks with mdparams and Attributes :folded:

The next block has complex ~:mdparams~ and other attributes.  
The filter should:

- Put ~js~ as the language
- Inline all attributes into the fence header
- Leave attribute order and values intact

#+begin_src javascript :mdparams showLineNumbers=false collapse={1-5, 12-14, 21-24} /\/ho.*\// "given text" {"1":5} del={"2":7-8} ins={"3":10-12}
function demo() {
  // Mark any given text inside lines
  return 'Multiple matches of the given text are supported';
}
echo "Test" > /home/test.txt
// All this boilerplate setup code will be collapsed
import { someBoilerplateEngine } from '@example/some-boilerplate'
import { evenMoreBoilerplate } from '@example/even-more-boilerplate'
#+end_src

#+RESULTS:

Here is some simple JavaScript code with ~:del~ and ~:ins~ attributes:

#+begin_src js  :del {"2":7-8} :ins {"3":10-12}
console.log('This code is syntax highlighted!')
#+end_src

Here is a separator to visually break sections in the output:

--------------

Code block attributes are transferred as-is from Org header args:

#+begin_src js :frame none
console.log('Title attribute example')
#+end_src

This line mimics a “title” attribute in the rendered Markdown:

=js title="my-test-file.js" 

Shell code block without any special attributes:

#+begin_src sh
echo "This terminal frame has no title"
#+end_src

Diff block that should be highlighted as JavaScript due to ~:lang js~:

#+begin_src diff :lang js
  function thisIsJavaScript() {
    // This entire block gets highlighted as JavaScript,
    // and we can still add diff markers to it!
-   console.log('Old code to be removed')
+   console.log('New and shiny code!')
  }
#+end_src

A block that uses ~:mdparams "given text"~ to mark text inside lines:

#+begin_src js :mdparams "given text"
function demo() {
  // Mark any given text inside lines
  return 'Multiple matches of the given text are supported';
}
#+end_src

* Jupyter / Session-Based Code and Example Output :ATTACH:
:PROPERTIES:
:ID:       fc070186-6f23-4192-9db6-258415ec39c7
:END:

Jupyter-like block with a Python session and simple text output:

#+begin_src jupyter-python  :session py :kernel devenv  :exports both
print("hi there")
#+end_src

#+RESULTS:
#+begin_example
hi there
#+end_example

More complex Jupyter block that produces a table-like textual result and an image:

#+begin_src jupyter-python  :session py :kernel devenv  :exports both :results file :file output.png
import matplotlib.pyplot as plt
import polars as pl

df = pl.DataFrame({
    "col1": [1, 2, 3],
    "col2": ["a", "b", "c"],
    "col3": [10.5, 20.1, 30.2],
    "col4": [True, False, True],
    "col5": [100, 200, 300],
    "col6": ["x", "y", "z"],
    "col7": [0.1, 0.2, 0.3],
})

print(df)
#+END_SRC

#+RESULTS:
#+begin_example
shape: (3, 7)
┌──────┬──────┬──────┬───────┬──────┬──────┬──────┐
│ col1 ┆ col2 ┆ col3 ┆ col4  ┆ col5 ┆ col6 ┆ col7 │
│ ---  ┆ ---  ┆ ---  ┆ ---   ┆ ---  ┆ ---  ┆ ---  │
│ i64  ┆ str  ┆ f64  ┆ bool  ┆ i64  ┆ str  ┆ f64  │
╞══════╪══════╪══════╪═══════╪══════╪══════╪══════╡
│ 1    ┆ a    ┆ 10.5 ┆ true  ┆ 100  ┆ x    ┆ 0.1  │
│ 2    ┆ b    ┆ 20.1 ┆ false ┆ 200  ┆ y    ┆ 0.2  │
│ 3    ┆ c    ┆ 30.2 ┆ true  ┆ 300  ┆ z    ┆ 0.3  │
└──────┴──────┴──────┴───────┴──────┴──────┴──────┘
#+end_example

See [[section two][go to section two]]


#+begin_src jupyter-python  :session py :kernel devenv  :exports both
import matplotlib.pyplot as plt
x = [1, 2, 3, 4]
y = [2, 4, 6, 8]
plt.plot(x, y)
plt.savefig('output.svg')

# import polars as pl

# df = pl.DataFrame({
#     "col1": [1, 2, 3],
#     "col2": ["a", "b", "c"],
#     "col3": [10.5, 20.1, 30.2],
#     "col4": [True, False, True],
#     "col5": [100, 200, 300],
#     "col6": ["x", "y", "z"],
#     "col7": [0.1, 0.2, 0.3],
# })

# print(df)
#+END_SRC

#+RESULTS:
[[file:.ob-jupyter/d1194631226c0b51c10bf2748939fde83e6bd9e3.png]]


#+begin_example
shape: (3, 7)
┌──────┬──────┬──────┬───────┬──────┬──────┬──────┐
│ col1 ┆ col2 ┆ col3 ┆ col4  ┆ col5 ┆ col6 ┆ col7 │
│ ---  ┆ ---  ┆ ---  ┆ ---   ┆ ---  ┆ ---  ┆ ---  │
│ i64  ┆ str  ┆ f64  ┆ bool  ┆ i64  ┆ str  ┆ f64  │
╞══════╪══════╪══════╪═══════╪══════╪══════╪══════╡
│ 1    ┆ a    ┆ 10.5 ┆ true  ┆ 100  ┆ x    ┆ 0.1  │
│ 2    ┆ b    ┆ 20.1 ┆ false ┆ 200  ┆ y    ┆ 0.2  │
│ 3    ┆ c    ┆ 30.2 ┆ true  ┆ 300  ┆ z    ┆ 0.3  │
└──────┴──────┴──────┴───────┴──────┴──────┴──────┘
#+end_example

#+NAME: duckdb-sql-query
#+begin_src duckdb :exports none
SELECT *,
  CASE WHEN n % 2 = 0 THEN 'Even' ELSE 'Odd' END AS parity
FROM (SELECT * FROM generate_series(1, 10000000) AS t(n))
WHERE n % 99999 = 0 LIMIT 4;
#+end_src

#+RESULTS: duckdb-sql-query
|  99999 | Odd  |
| 199998 | Even |
| 299997 | Odd  |
| 399996 | Even |

#+begin_src python :results output :noweb yes :noweb-prefix no :exports both

import duckdb
duckdb.sql("""<<duckdb-sql-query>>""").show()

#+end_src

#+RESULTS:
#+begin_example
┌────────┬─────────┐
│   n    │ parity  │
│ int64  │ varchar │
├────────┼─────────┤
│  99999 │ Odd     │
│ 199998 │ Even    │
│ 299997 │ Odd     │
│ 399996 │ Even    │
└────────┴─────────┘

#+end_example





